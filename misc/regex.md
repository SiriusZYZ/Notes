---
aliases:
  - 正则表达式
date: 2024-05-27
---
# 正则表达式简介

正则表达式(Regular Expression, regex)是一种文本模式，可以用于描述或匹配字符串的特定模式(pattern)

## 模式

模式 (pattern) 是指一种字符的组合方式，比如4个数字字符的模式可以被`0123` 匹配。

regex模式的表示方式也是一组字符串，可以包含：
- 字符的字面值：包括字母、数字、空格、连字符`-_`，可以直接匹配到本身
- 字符集合：`[]` 方括号内包含一系列字符的字面值，用于匹配其中的任意一个字符
- 元字符：`\d`, `\w`, `\s` 用于匹配特定字符，如数字、字母、空白字符等
- 特殊字符：`.*+?` 等将被转义，包含特殊意义及功能
- 量词：`{n}, {n,}, {n, m}`指定匹配左边的模式多少次
- 边界符号：`^$\b\B` 用于匹配字符串的开头、结尾或单次边界位置

regex的模式在各环境的支持性

| **命令或环境**      | **.** | **[ ]** | **^** | **$** | **\\( \\)** | **\\{ \\}** | **?** | **+** | **\|** | **( )** |
| -------------- | ----- | ------- | ----- | ----- | ----------- | ----------- | ----- | ----- | ------ | ------- |
| **vi**         | √     | √       | √     | √     | √           |             |       |       |        |         |
| **Visual C++** | √     | √       | √     | √     | √           |             |       |       |        |         |
| **awk**        | √     | √       | √     | √     |             | √*          | √     | √     | √      | √       |
| **sed**        | √     | √       | √     | √     | √           | √           |       |       |        |         |
| **delphi**     | √     | √       | √     | √     | √           |             | √     | √     | √      | √       |
| **python**     | √     | √       | √     | √     | √           | √           | √     | √     | √      | √       |
| **java**       | √     | √       | √     | √     | √           | √           | √     | √     | √      | √       |
| **javascript** | √     | √       | √     | √     | √           |             | √     | √     | √      | √       |
| **php**        | √     | √       | √     | √     | √           |             |       |       |        |         |
| **perl**       | √     | √       | √     | √     | √           |             | √     | √     | √      | √       |
| **C#**         | √     | √       | √     | √     |             |             | √     | √     | √      | √       |
\* 支持，但要命令行加入 `--posix`或` --re-interval`，见man awk中的interval expression


# 模式的编写规则

## 单个普通字符

`c`: 模式为匹配单个字符"c":
```python
>>> re.findall(r"o", "google")
['o', 'o']
```

## 方括号和字符集合

`[]` 用于表示一个字符集合，用于匹配方括号内的任意一个字符
1.  通常，可以单个单个列出，比如`[aeiou]`
```python
>>> re.findall(r"[aeiou]", "google apple microsoft uber")
['o', 'o', 'e', 'a', 'e', 'i', 'o', 'o', 'u', 'e']
```
2. 也可以使用连词符号表示一系列范围，如`[a-g4-7]`，不必要是`a-zA-Z` 等完整的列表
```python
>>> re.findall(r"[a-gw-z]", "google apple microsoft")
['g', 'g', 'e', 'a', 'e', 'c', 'f']
```
3. 当字符集合首个字符是`^` 时，表示对集合取反，即匹配不在方括号内的任意字符
```python
>>> re.findall(r"[^aeiou]", "google apple microsoft")
['g', 'g', 'l', ' ', 'p', 'p', 'l', ' ', 'm', 'c', 'r', 's', 'f', 't']
```
4. 字符集合中所有元字符会失去其转义属性
```python
>>> re.findall(r".", "hello world.")
['h', 'e', 'l', 'l', 'o', ' ', 'w', 'o', 'r', 'l', 'd', '.']
>>> re.findall(r"[.]", "hello world.")
['.']
```
## 元字符
元字符用于匹配特定类型字符、位置等。
### 匹配一组特定类型的字符

| 字符   | 等价               | 描述                       |
| ---- | ---------------- | ------------------------ |
| `.`  | `[^\n\r]`        | 匹配除换行外的所有字符，特殊模式下可以包含换行符 |
| `\d` | `[0-9]`          | 匹配十进制数字`0-9`             |
| `\D` | `[^0-9]`         | 匹配不属于十进制数的任意字符           |
| `\w` | `[a-zA-z0-9_]`   | 匹配单词类字符所有大小写拉丁字母，数字及下划线  |
| `\W` | `[^a-zA-z0-9_]`  | 匹配非单词类字符                 |
| `\s` | `[ \f\n\r\t\v]`  | 匹配任何空白字符，包括空格、制表符、换页符    |
| `\S` | `[^ \f\n\r\t\v]` | 匹配任何非空白字符                |
```python
>>> re.findall(r".", "1:google 2:apple")
['1', ':', 'g', 'o', 'o', 'g', 'l', 'e', ' ', '2', ':', 'a', 'p', 'p', 'l', 'e']
>>> re.findall(r"\d", "1:google 2:apple")
['1', '2']
>>> re.findall(r"\D", "1:google 2:apple")
[':', 'g', 'o', 'o', 'g', 'l', 'e', ' ', ':', 'a', 'p', 'p', 'l', 'e']
```

### 匹配带有特殊含义的字符

由于有些单个字符在regex中有特殊含义，当我们想匹配这些字符时，就可能需要放转义的方法。抗转义有两种方式，即适用斜杠及中括号

`\` 抗转义支持这些字符：
- `()[]{}` 括号类
- `^*?+.\^|` 这些具有特殊含义的元字符
- 例如: `\\` 匹配字面的`\`， `\*` 匹配字面的`*`

`[]` 在方括号内防止字符转义
- `()[]{}` 括号类
- `^*?+.\^|` 这些具有特殊含义的元字符
- 方括号不会对诸如`\d` `\s` 等元字符进行抗转义

### 匹配非打印字符

非打印字符包括了:
- 空格、回车、换行、换页、制表这些符号
- 还包括空字符

如下表所示，用得比较多的是`\s` 和`\S`，直观地说，`\s` 和`\S` 就是一对互斥集合

| 非打印字符 | 描述                                                                                    |
| ----- | ------------------------------------------------------------------------------------- |
| `\s`  | 匹配任何空白字符，包括空格、制表符、换页符等等。等价于<br>` [ \f\n\r\t\v]`。注意 Unicode 正则表达式会匹配全角空格符。             |
| `\S`  | 匹配任何非空白字符。等价于 `[^ \f\n\r\t\v]`                                                        |
| `\n`  | 匹配一个换行符。等价于` \x0a `和` \cJ`。                                                           |
| `\r`  | 匹配一个回车符。等价于 `\x0d `和 `\cM`。                                                           |
| `\t`  | 匹配一个制表符。等价于 \x09 和 \cI。                                                               |
| `\v`  | 匹配一个垂直制表符。等价于 \x0b 和 \cK。                                                             |
| `\cx` | 匹配由x指明的控制字符。例如， `\cM `匹配一个 Control-M 或回车符。x 的值必须为 A-Z 或 a-z 之一。否则，将 c 视为一个原义的 'c' 字符。 |
| `\f`  | 匹配一个换页符。等价于 `\x0c `和` \cL`。                                                           |

### 匹配位置

某些情况下，我想找到所有以`tion`结尾的单词，这就要求regex提供针对位置的匹配。
正则表达式中的匹配，其匹配为“零宽度”的匹配。为了理解字符串里面的“位置”，可以把字符串理解为`"".join(splitted_string)`，即以空字符拼接起来的字符串：
```text
"abc" = "" + "a" + "" + "b" + "" + "c" + ""
```
位置是指对应模式处前/后的那个空字符。比如单词匹配，是匹配`\w`和`\W`之间的那个空字符，因此其之前是`\w`，之后是`\W`。

| 元字符            | 描述                                        |
| -------------- | ----------------------------------------- |
| `^`            | 匹配字符串的开头，多行模式下匹配句首                        |
| `$`            | 匹配字符串的尾部，多行模式下匹配句尾                        |
| `\b`           | 匹配单词与空格的交界，即`\w`和`\W` 的边界，包含`\w\W`和`\W\w` |
| `\B`           | 匹配非单词与空格的交界                               |
| `(?=pattern)`  | 匹配`pattern`之前的那个位置                        |
| `(?!pattern)`  | 匹配非`pattern`之前的那个位置                       |
| `(?<=pattern)` | 匹配`pattern`之后的那个位置                        |
| `(?<！pattern)` | 匹配非`pattern`之后的那个位置                       |

```python
>>> text = "This is line1\nThis is line2"
# Case 1, 默认非多行模式下，"^"只能匹配字符串开头
>>> re.sub(r"^", "#", text)
'#This is line1\nThis is line2'
# Case 2, 默认多行模式下，"^"能匹配字符串每一行开头
>>> re.sub(r"^", "#", text, flags=re.MULTILINE)
'#This is line1\n#This is line2'
```

```python
# \b用于匹配单词开头或结尾
>>> re.sub(r"\b", "#", "hello world!")
'#hello# #world#!'
# \b可以匹配中文
>>> re.sub(r"\b", "#", "你好!")
'#你好#!'
# \b匹配也可以匹配数字
>>> re.sub(r"\b", "#", "I have 4 burgers!")
'#I# #have# #4# #burgers#!'
# \b 等价于 (?<!\w)(?=\w)|(?<=\w)(?!\w)
>>> re.sub(r"(?<!\w)(?=\w)|(?<=\w)(?!\w)", "#", "hello world!")
# 使用\b查找以`tion`结尾的单词
>>> re.findall(r"\w+tion\b", "The completion required evaluation and implementation.")
['completion', 'evaluation', 'implementation']
```

```python
# (?=p) 用于匹配模式前面的位置
>>> re.sub(r"(?=source)","#", "open source")
'open #source'
# (?<=p) 用于匹配模式后面的位置
>>> re.sub(r"(?<=source)","#", "open source")
'open source#'
```
## 圆括号和子模式

## 模式的重复