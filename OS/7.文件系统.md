
# 7.1概述

文件——一组有意义的信息、数据的集合
文件内部的数据是如何组织起来的？
文件之间有应该如何组织、存放？


> 文件的属性

| 属性           | 描述                                                       |
| -------------- | ---------------------------------------------------------- |
| 文件名         | 用户决定的文件名，主要是方便访问。同一目录下不能有重名文件 |
| 标识符         | 系统对文件的唯一标识，用于区分各个文件，对用户毫无可读性   |
| 类型           | 指明文件的类型                                             |
| 路径           | 文件存放的路径(用户可见)                                   |
| 外存地址       | 在外存中的物理路径(系统可见, 用户不可见)                   |
| 大小           |                                                            |
| 创建时间       |                                                            |
| 上次修改时间   |                                                            |
| 文件所有者信息 |                                                            |
| 保护信息       | 比如各用户组对文件的读写权限                                                           |


> **==树状组织==**
> 可以创建一系列树状的文件目录以存放文件

>**==文件的系统调用==**
>应有创建、读、写、删除文件的系统调用，还有打开、关闭系统调用(读写加锁)

> **==文件分块==**
> 和内存分页储存技术相似，使用分块的外存储存文件。



# 7.2文件的逻辑结构

逻辑结构：文件内部在用户看来是如何组织的

>**==流式文件 / 无结构文件==**
>如`.txt` 文件，文件内部是一系列字符串或二进制符号，没有明显的结构

>**==记录式文件  / 有结构文件==**
>1. 如`.xlxs`等文件，文件内部按一定方式组织了结构相同的记录
>2. 每条记录可能占据相同的长度，也可能不。形成定长记录和变长记录两种。


## 7.2.1|有结构文件的逻辑结构

### 7.2.1.1|顺序文件

**记录间组织**：逻辑上一个接一个地排列
**记录实现**：顺序存储或链式存储
**记录的结构**：可以是定长或变长

![[Pasted image 20230719161059.png]]
很显然，想要能快速实现随机访问，必须有一定的方式实现索引到实际地址的快速转换。链式存储不行，而不定长的记录也不行。必须是按顺序排好的、每个单元格长度固定的才能快速找到。

>**==索引文件==**
>对于可变长文件，可以使用一个连续的数组存储指向某条记录的指针和记录长度。并可以实现离散存储

> **==索引顺序文件==**
> - 索引文件可以使用多次分组查找，比如像新华字典一样。可以先再目录找拼音开头是B的，再在里面找Bao，再找到Bao对应的实际页码
> - 



# 7.3文件目录

## 7.3.1|文件控制块

**==目录文件==**
- 一个目录对应了一个目录文件，目录文件是一种有结构文件
- 目录文件包含该目录下的所有一级内容的详细信息
- 每一项包含文件名、类型、读写权限、**文件在外存中的物理地址**
![[Pasted image 20230721103652.png]]
**==文件控制块 / File Control Block, FCB==**
- 每一条目录文件中的项就是一个**文件控制块(File Control Block, FCB)**
- 和内存中的PCB很相似：一个在内存，信息指向内存中的东西。一个在外存，信息指向在外存中的东西。
- 应能够实现以下功能：
  1. 搜索
  2. 创建文件
  3. 删除文件
  4. 显示目录
  5. 修改文件或目录项内容

## 7.3.2|单级目录

- 早期操作系统，整个系统中只有一张目录表，每个文件只占用一个目录项
- 整个文件目录中无重名文件或目录


## 7.3.3|两级目录
![[Pasted image 20230721111533.png]]
- 分为主文件目录和用户文件目录
- 主文件目录保存用户名和用户文件目录的映射
- 用户文件目录保存FCB
- 可以实现用户间文件的隔离


## 7.3.4|树形目录

![[Pasted image 20230721112305.png]]
- 现代常用的
- 同一目录下不能重名(因为同一张目录文件内不能有重名FCB)
- 分为绝对地址和相对地址
- 树形结构不便于实现文件共享


## 7.3.5|索引节点
![[Pasted image 20230721113345.png]]
- 简而言之，就是把文件名和内容分离。
- 索引节点完成**文件名---->详细信息指针**的映射